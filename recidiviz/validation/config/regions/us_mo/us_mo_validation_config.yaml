# Configuration for which validations to run for region US_MO.

region_code: US_MO
exclusions:
  - validation_name: supervision_population_person_level_external_comparison_matching_people_supervision_level
    exclusion_type: DOES_NOT_APPLY
    exclusion_reason: MO has not provided us with person-level validation data for supervision level
  - validation_name: supervision_population_person_level_external_comparison_matching_people_supervising_officer
    exclusion_type: DOES_NOT_APPLY
    exclusion_reason: MO has not provided us with person-level validation data for supervising officers
max_allowed_error_overrides:
  - validation_name: supervision_population_person_level_external_comparison_matching_people_district
    hard_max_allowed_error_override: 1.0
    override_reason: TODO(#15466) - Fix reference view hydration to compare external data correctly.
  - validation_name: sentence_type_by_district_by_demographics_internal_consistency
    hard_max_allowed_error_override: 0.2
    override_reason: TODO(#5074) - The age_bucket_breakdown_sum column does not match the others - investigate.
  - validation_name: most_recent_assessment_date_by_person_by_state_comparison
    hard_max_allowed_error_override: 0.5
    override_reason: Needs investigation.
  - validation_name: most_recent_assessment_score_by_person_by_state_comparison
    hard_max_allowed_error_override: 1.0
    override_reason: Needs investigation.
num_allowed_rows_overrides:
  - validation_name: overlapping_incarceration_periods
    hard_num_allowed_rows_override: 20000
    override_reason:
      In MO we rely on a table where they build incarceration period
      spans for us; some older rows have issues with overlap. Rerun did not improve this number. Error at 411
      rows as of 04/12/2022. Current error at 526 on 9/27/2022. TODO(#2738) - This issue should be resolved when we rewrite MO incarceration periods
      query to derive periods directly from the status codes table. TODO(#15905) - Rework in incarceration periods increased error. View/normalization investigation needed to improve error of 7028 as of 10/5/2022. However, only 335 of these periods (as of 10/05/2022) are from after 2010.
      Inital investigations into this show entity deletion as the main culprit. A new full historical dump will be needed to correct these.
  - validation_name: overlapping_supervision_periods
    hard_num_allowed_rows_override: 2500
    override_reason:
      Older raw data from MO contains overlapping period information that we do not correct. TODO(#9848) - In addition,
      we do a lot of preprocessing for supervision periods that is not yet persisted, which corrects almost all supervision periods
      that do follow standard formats. Rerun decreased error significantly, bumping threshold down to 1500 to note if it greatly
      increases again. Current error was at 1121 rows as of 03/01/2022. Error began steadily increasing again and is now
      at 1699 as of 07/01/2022. 2041 as of 9/27/2022. Will require more investigation.
  - validation_name: incarceration_admission_after_open_period
    hard_num_allowed_rows_override: 700
    override_reason: TODO(#15905). TODO(#16331) - Similar to failing overlapping_incarceration_periods, entity deletion appears to be a major culprit for duplicate periods over time (causing this validation to fail when the duplicate period is an open one. A new full historical dump will be needed to correct these.
  - validation_name: admission_pfi_pop_pfi_mismatch
    hard_num_allowed_rows_override: 80
    override_reason: TODO(#10625) - Need to be handled in IP pre-processing. TODO(#15905) - Relatedly from rework, need to handle same day periods more explicitly.
  - validation_name: incarceration_release_prior_to_admission
    hard_num_allowed_rows_override: 22
    override_reason: TODO(#15706) - Investigate and eventually account for these specific situations from old raw data. After incarceration periods rework to include facility information, there are now a small number of rows from very old data that have a release  happening prior to admission. This is likely due to the multiple date sources we combine in the view and how we handle those periods. Because it is all from data older than 2000, this number should not grow.
  - validation_name: sentence_end_dates_before_start_dates
    hard_num_allowed_rows_override: 1500000
    override_reason: Needs investigation.  Current failing level as of 10/21 is 1,335,497 rows #TODO(#16182)
  - validation_name: session_new_admissions_with_no_sentence_date_imposed
    hard_num_allowed_rows_override: 250000
    override_reason: Needs investigation.  Current failing level as of 10/26 is 195,120 rows #TODO(#16226)
  - validation_name: session_liberty_releases_with_no_sentence_completion_date
    hard_num_allowed_rows_override: 150000
    override_reason: Needs investigation.  Current failing level as of 10/26 is 102,721 rows #TODO(#16239)
  - validation_name: sentences_missing_date_imposed
    hard_num_allowed_rows_override: 4000
    override_reason: Needs investigation.  Current failing level as of 11/2 is 2,868 rows #TODO(#16437)
  - validation_name: sessions_persons_in_incarceration_or_supervision
    hard_num_allowed_rows_override: 190000
    override_reason: Currently have different logic between sessions and incarceration/supervision period views to filter out certain types of periods. #TODO(#15790) - Investigate best fix for longterm parity betweeen sessions and periods
