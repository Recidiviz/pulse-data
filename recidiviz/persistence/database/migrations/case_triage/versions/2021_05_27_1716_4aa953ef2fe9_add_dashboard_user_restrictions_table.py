# pylint: skip-file
"""add_dashboard_user_restrictions_table

Revision ID: 4aa953ef2fe9
Revises: 44225cbc4e9a
Create Date: 2021-05-27 17:16:43.351294

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = "4aa953ef2fe9"
down_revision = "a3e3c788c6e6"
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "dashboard_user_restrictions",
        sa.Column(
            "state_code",
            sa.String(length=255),
            nullable=False,
            comment="Dashboard user's state code",
        ),
        sa.Column(
            "restricted_user_email",
            sa.String(length=255),
            nullable=False,
            comment="Dashboard user's email address",
        ),
        sa.Column(
            "allowed_level_1_supervision_location_ids",
            sa.String(length=255),
            nullable=False,
            comment="Deprecated column for allowed supervision location ids",
        ),
        sa.Column(
            "allowed_supervision_location_ids",
            sa.ARRAY(sa.String()),
            nullable=False,
            comment="Array of supervision location IDs the user can access",
        ),
        sa.Column(
            "allowed_supervision_location_level",
            sa.String(length=255),
            nullable=True,
            comment="The supervision location level, i.e. level_1_supervision_location",
        ),
        sa.Column(
            "internal_role",
            sa.String(length=255),
            nullable=False,
            comment="Dashboard user's access level role",
        ),
        sa.PrimaryKeyConstraint("restricted_user_email"),
        sa.UniqueConstraint("state_code", "restricted_user_email"),
    )
    op.create_index(
        op.f("ix_dashboard_user_restrictions_restricted_user_email"),
        "dashboard_user_restrictions",
        ["restricted_user_email"],
        unique=False,
    )
    op.create_index(
        op.f("ix_dashboard_user_restrictions_state_code"),
        "dashboard_user_restrictions",
        ["state_code"],
        unique=False,
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(
        op.f("ix_dashboard_user_restrictions_state_code"),
        table_name="dashboard_user_restrictions",
    )
    op.drop_index(
        op.f("ix_dashboard_user_restrictions_restricted_user_email"),
        table_name="dashboard_user_restrictions",
    )
    op.drop_table("dashboard_user_restrictions")
    # ### end Alembic commands ###
