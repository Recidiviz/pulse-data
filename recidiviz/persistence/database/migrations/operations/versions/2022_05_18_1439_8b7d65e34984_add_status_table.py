# pylint: skip-file
"""add_status_table

Revision ID: 8b7d65e34984
Revises: 38483f72dca7
Create Date: 2022-05-18 14:39:46.995986

"""
import sqlalchemy as sa
from alembic import op
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = "8b7d65e34984"
down_revision = "38483f72dca7"
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "direct_ingest_instance_status",
        sa.Column("region_code", sa.String(length=255), nullable=False),
        sa.Column("timestamp", sa.DateTime(), nullable=False),
        sa.Column(
            "instance",
            postgresql.ENUM(
                "PRIMARY", "SECONDARY", name="direct_ingest_instance", create_type=False
            ),
            nullable=False,
        ),
        sa.Column(
            "status",
            postgresql.ENUM(
                "RERUN_WITH_RAW_DATA_IMPORT_STARTED",
                "STANDARD_RERUN_STARTED",
                "SECONDARY_RERUN_RESULTS_FLASHED",
                "RAW_DATA_IMPORT_IN_PROGRESS",
                "INGEST_VIEW_MATERIALIZATION_IN_PROGRESS",
                "EXTRACT_AND_MERGE_IN_PROGRESS",
                "READY_TO_FLASH",
                "STALE_RAW_DATA",
                "UP_TO_DATE",
                "FLASH_IN_PROGRESS",
                "FLASH_COMPLETED",
                name="direct_ingest_status",
            ),
            nullable=False,
        ),
        sa.PrimaryKeyConstraint("region_code", "timestamp", "instance"),
    )
    op.create_index(
        op.f("ix_direct_ingest_instance_status_instance"),
        "direct_ingest_instance_status",
        ["instance"],
        unique=False,
    )
    op.create_index(
        op.f("ix_direct_ingest_instance_status_region_code"),
        "direct_ingest_instance_status",
        ["region_code"],
        unique=False,
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(
        op.f("ix_direct_ingest_instance_status_region_code"),
        table_name="direct_ingest_instance_status",
    )
    op.drop_index(
        op.f("ix_direct_ingest_instance_status_instance"),
        table_name="direct_ingest_instance_status",
    )
    op.drop_table("direct_ingest_instance_status")
    postgresql.ENUM(
        "RERUN_WITH_RAW_DATA_IMPORT_STARTED",
        "STANDARD_RERUN_STARTED",
        "SECONDARY_RERUN_RESULTS_FLASHED",
        "RAW_DATA_IMPORT_IN_PROGRESS",
        "INGEST_VIEW_MATERIALIZATION_IN_PROGRESS",
        "EXTRACT_AND_MERGE_IN_PROGRESS",
        "READY_TO_FLASH",
        "STALE_RAW_DATA",
        "UP_TO_DATE",
        "FLASH_IN_PROGRESS",
        "FLASH_COMPLETED",
        name="direct_ingest_status",
    ).drop(op.get_bind())
    # ### end Alembic commands ###
