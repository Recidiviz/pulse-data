# This file is used to manually trigger and submit a build from the command line.
# It builds a docker image with tag "us-docker.pkg.dev/$PROJECT_ID/dataflow/build:$COMMIT_SHA" using the provided Dockerfile recidiviz/calculator/pipeline/Dockerfile.pipeline,
# and specifies it to be pushed to cloud build to "us-docker.pkg.dev/$PROJECT_ID/dataflow/build:$COMMIT_SHA".
# This file is used by the terraform build trigger, and also can be used to manually submit a build via gcloud builds submit
# Example usage:
# gcloud builds submit --project=recidiviz-staging --config recidiviz/calculator/pipeline/cloudbuild.pipelines.yaml
steps:
  - name: "gcr.io/cloud-builders/docker"
    args:
      [
        "build",
        "-t",
        "us-docker.pkg.dev/$PROJECT_ID/dataflow/build:$COMMIT_SHA",
        "-f",
        "recidiviz/calculator/pipeline/Dockerfile.pipelines",
        ".",
      ]
images:
  - "us-docker.pkg.dev/$PROJECT_ID/dataflow/build:$COMMIT_SHA"
