# This file is used to manually trigger and submit a build from the command line.
# It builds a docker image with tag "us-docker.pkg.dev/$PROJECT_ID/dataflow/build:$COMMIT_SHA" using the provided Dockerfile recidiviz/pipelines/Dockerfile.pipeline,
# and specifies it to be pushed to cloud build to "us-docker.pkg.dev/$PROJECT_ID/dataflow/build:$COMMIT_SHA".
# This file is used by the terraform build trigger, and also can be used to manually submit a build via gcloud builds submit
# Example usage:
# gcloud builds submit --project=recidiviz-staging --config recidiviz/pipelines/cloudbuild.pipelines.yaml
steps:
  - name: "gcr.io/kaniko-project/executor:v1.8.1"
    args:
      [
        "--destination=us-docker.pkg.dev/$PROJECT_ID/dataflow/build:$COMMIT_SHA",
        "--cache=true",
        "--dockerfile=recidiviz/pipelines/Dockerfile.pipelines",
      ]
