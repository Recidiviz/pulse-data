# yaml-language-server: $schema=./../../../ingest_mappings/yaml_schema/1.0.0/schema.json
# This file associates the columns outputted from the query in `view_state_persons` to the corresponding
# Ingest Object fields.
manifest_language: 1.0.0
input_columns:
  - offender_number
  - last_name
  - first_name
  - middle_name
  - name_suffix
  - birth_date
  - gender_id
  - race_id
  - cultural_affiliation_id
  - hispanic_flag
unused_columns: []
output:
  StatePerson:
    external_ids:
      - StatePersonExternalId:
          external_id: offender_number
          id_type: $literal("US_MI_DOC")
    birthdate: birth_date
    full_name:
      $person_name:
        $given_names: first_name
        $middle_names: middle_name
        $surname: last_name
        $name_suffix: name_suffix
    gender:
      $enum_mapping:
        $raw_text: gender_id
        $mappings:
          StateGender.MALE: "435"
          StateGender.FEMALE: "434"
          StateGender.EXTERNAL_UNKNOWN: "7403"
    races:
      - StatePersonRace:
          race:
            $enum_mapping:
              $raw_text: race_id
              $mappings:
                StateRace.AMERICAN_INDIAN_ALASKAN_NATIVE: "373"
                StateRace.NATIVE_HAWAIIAN_PACIFIC_ISLANDER: "9875"
                StateRace.WHITE: "685"
                StateRace.BLACK: "371"
                StateRace.ASIAN: "372"
                StateRace.EXTERNAL_UNKNOWN: "7404"
                StateRace.INTERNAL_UNKNOWN:
                  - "20096" # Latino
                  - "20095" # Middle Eastern/North African

    ethnicities:
      - $conditional:
          - $if:
              $equal:
                - hispanic_flag
                - $literal("1")
            $then:
              StatePersonEthnicity:
                ethnicity: $literal_enum(StateEthnicity.HISPANIC)
          - $else_if:
              $not_null: cultural_affiliation_id
            $then:
              StatePersonEthnicity:
                ethnicity:
                  $enum_mapping:
                    $raw_text: cultural_affiliation_id
                    $mappings:
                      StateEthnicity.HISPANIC:
                        - "608" # Mexican
                        - "602" # Hispanic
                        - "20054" # Puerto Rican
                        - "20082" # Cuban
                        - "20070" # Guatemalan
                        - "20056" # Nicaraguan
                    $ignore:
                      - "603"
                      - "624"
                      - "606"
                      - "621"
                      - "1172"
                      - "1171"
                      - "1170"
                      - "622"
                      - "607"
                      - "625"
                      - "605"
                      - "604"
                      - "601"
                      - "20092"
                      - "20079"
                      - "20049"
                      - "20067"
                      - "20052"
                      - "20075"
                      - "20063"
                      - "20065"
                      - "20080"
                      - "20060"
                      - "20066"
                      - "20055"
                      - "20053"
