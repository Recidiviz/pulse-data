# yaml-language-server: $schema=./../../../ingest_mappings/yaml_schema/1.0.0/schema.json
manifest_language: 1.0.0
input_columns:
  PERSON_ID: STRING
  OFFENSE_ID: STRING
  initial_status_dt: DATETIME
  initial_status_raw_text: STRING
  final_status_dt: DATETIME
  final_status_raw_text: STRING
unused_columns: []
output:
  StatePerson:
    external_ids:
      - StatePersonExternalId:
          external_id: PERSON_ID
          id_type: $literal("US_AZ_PERSON_ID")
    sentences:
      - StateSentence:
          external_id: OFFENSE_ID
          sentence_status_snapshots:
            - $conditional:
                - $if:
                    $not_null: initial_status_dt
                  $then:
                    StateSentenceStatusSnapshot:
                      sequence_num: $literal("1")
                      status_update_datetime: initial_status_dt
                      status:
                        $enum_mapping:
                          $raw_text: initial_status_raw_text
                          $custom_parser: us_az_custom_enum_parsers.parse_sentence_status
            - $conditional:
                - $if:
                    $not_null: final_status_dt
                  $then:
                    StateSentenceStatusSnapshot:
                      sequence_num: $literal("2")
                      status_update_datetime: final_status_dt
                      status:
                        $enum_mapping:
                          $raw_text: final_status_raw_text
                          $custom_parser: us_az_custom_enum_parsers.parse_sentence_status
