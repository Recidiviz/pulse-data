# yaml-language-server: $schema=./../../../ingest_mappings/yaml_schema/1.0.0/schema.json
# This file associates the columns outputted from the query in `view_person_housing_status_period` to
#  corresponding Ingest Object fields.
manifest_language: 1.0.0
input_columns:
  person_id: STRING
  location_id: STRING
  start_date: DATE
  end_date: DATE
  address_type: STRING
  address_line_1: STRING
  address_line_2: STRING
  zipcode: STRING
  city: STRING
  state: STRING
  county: STRING
  country: STRING
unused_columns:
  - location_id
output:
  StatePerson:
    external_ids:
      - StatePersonExternalId:
          external_id: person_id
          id_type: $literal("US_AZ_PERSON_ID")
    housing_status_periods:
      - StatePersonHousingStatusPeriod:
          housing_status_start_date: start_date
          housing_status_end_date: end_date
          housing_status_type:
            $enum_mapping:
              $raw_text: address_type
              $mappings:
                StatePersonHousingStatusType.UNHOUSED:
                  - "homeless"
                StatePersonHousingStatusType.FACILITY:
                  - "facility"
                StatePersonHousingStatusType.PERMANENT_RESIDENCE:
                  - "permanent_residence"
                StatePersonHousingStatusType.EXTERNAL_UNKNOWN:
                  - "external_unknown"
    address_periods:
      - $conditional:
          - $if:
              $not:
                $equal:
                  - address_line_1
                  - $literal("UNKNOWN")
            $then:
              StatePersonAddressPeriod:
                address_start_date: start_date
                address_end_date: end_date
                address_line_1: address_line_1
                address_line_2: address_line_2
                address_city: city
                address_state: state
                address_country: country
                address_zip: zipcode
                address_county: county
                address_type:
                  $enum_mapping:
                    $raw_text: address_type
                    $mappings:
                      StatePersonAddressType.PHYSICAL_RESIDENCE:
                        - "permanent_residence"
                      StatePersonAddressType.PHYSICAL_OTHER:
                        - "facility"
                        - "homeless"
                      StatePersonAddressType.EXTERNAL_UNKNOWN:
                        - "external_unknown"
