# yaml-language-server: $schema=./../../../ingest_mappings/yaml_schema/1.0.0/schema.json
manifest_language: 1.0.0
input_columns:
  - START_DATE
  - PROBABLE_RELEASE_DATE
  - SENTENCE_EXPIRY_DATE
  - OFFENDER_BOOK_ID
  - SENTENCE_STATUS
  - COMMENT_TEXT
  - EFFECTIVE_DATE
  - EIGHTYFIVE_PERCENT_DATE
  - GOOD_TIME
  - SENTENCE_CALC_TYPE
  - CHARGE_SEQ
  - CONSEC_TO_SENTENCE_SEQ
  - CONSECUTIVE_COUNT_FLAG
  - COUNTS
  - SENTENCE_SEQ
  - CREATE_DATETIME
  - MODIFY_DATETIME
unused_columns:
  - SENTENCE_STATUS
  - COMMENT_TEXT
  - EFFECTIVE_DATE
  - EIGHTYFIVE_PERCENT_DATE
  - GOOD_TIME
  - CHARGE_SEQ
  - CONSEC_TO_SENTENCE_SEQ
  - CONSECUTIVE_COUNT_FLAG
  - COUNTS
  - CREATE_DATETIME
  - MODIFY_DATETIME
variables:
  - book_id_int:
      $custom:
        $function: us_nd_custom_parsers.decimal_str_as_int_str
        $args:
          dec_str: OFFENDER_BOOK_ID
output:
  StatePerson:
    external_ids:
      - StatePersonExternalId:
          external_id: $variable(book_id_int)
          id_type: $literal("US_ND_ELITE_BOOKING")
    incarceration_sentences:
      - StateIncarcerationSentence:
          external_id:
            $concat:
              $separator: "-"
              $values:
                - $variable(book_id_int)
                - SENTENCE_SEQ
          status: $literal_enum(StateSentenceStatus.PRESENT_WITHOUT_INFO)
          incarceration_type: $literal_enum(StateIncarcerationType.STATE_PRISON)
          start_date: START_DATE
          effective_date: START_DATE
          is_life:
            $equal:
              - SENTENCE_CALC_TYPE
              - $literal("LIFE")
          projected_min_release_date: PROBABLE_RELEASE_DATE
          projected_max_release_date: SENTENCE_EXPIRY_DATE
