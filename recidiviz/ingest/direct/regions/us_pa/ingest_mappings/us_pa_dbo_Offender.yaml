# yaml-language-server: $schema=./../../../ingest_mappings/yaml_schema/1.0.0/schema.json
manifest_language: 1.0.0
input_columns:
  - recidiviz_primary_person_id
  - ParoleNumber
  - OffSex
  - races_ethnicities_list
  - OffRaceEthnicGroup
  - first_name
  - last_name
  - suffix
unused_columns:
  - recidiviz_primary_person_id # Internal Recidiviz person ID
  - OffRaceEthnicGroup # Redundant of races_ethnicities_list
output:
  StatePerson:
    external_ids:
      - StatePersonExternalId:
          external_id: ParoleNumber
          id_type: $literal("US_PA_PBPP")
    full_name:
      $person_name:
        $given_names: first_name
        $surname: last_name
        $name_suffix: suffix
    aliases:
      - StatePersonAlias:
          full_name:
            $person_name:
              $given_names: first_name
              $surname: last_name
              $name_suffix: suffix
          alias_type: $literal_enum(StatePersonAliasType.GIVEN_NAME)
    gender:
      $enum_mapping:
        $raw_text: OffSex
        $mappings:
          Gender.MALE: M
          Gender.FEMALE: F
    races:
      - $foreach:
          $iterable: races_ethnicities_list
          $result:
            StatePersonRace:
              race:
                $enum_mapping:
                  $raw_text: $iter_item
                  $mappings:
                    Race.ASIAN: A
                    Race.BLACK: B
                    Race.AMERICAN_INDIAN_ALASKAN_NATIVE: I
                    Race.OTHER: N
                    Race.WHITE: W
                  $ignore:
                    # This is an ethnicity value - ignore when mapping to race.
                    - H
                    # This is an erroneous value - ignore it.
                    - M
    ethnicities:
      - $foreach:
          $iterable: races_ethnicities_list
          $result:
            StatePersonEthnicity:
              ethnicity:
                $enum_mapping:
                  $raw_text: $iter_item
                  $mappings:
                    Ethnicity.HISPANIC: H
                  # These are race values - ignore when mapping to ethnicity.
                  $ignore: [A, B, I, N, W, M]
