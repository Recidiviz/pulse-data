manifest_language: 1.0.0
input_columns:
  - control_number
  - misconduct_number
  - misconduct_date
  - institution
  - report_date
  - hearing_after_date
  - form_141
  - data_followup
  - sig_date
  - sig_time
  - user_id
  - inst_hvl_desc
  - place_hvl_desc
  - place_hvl_code
  - place_extended
  - misconduct_time
  - others_involved
  - ctgory_of_chrgs_1
  - ctgory_of_chrgs_2
  - ctgory_of_chrgs_3
  - ctgory_of_chrgs_4
  - ctgory_of_chrgs_5
  - confinement
  - confinement_date
  - confinement_time
  - hearings_held
  - witnesses
  - inmate_version
  - recording_staff
  - rcrdng_staff_last
  - reviewing_staff
  - revwng_staff_last
  - date_reviewed
  - inmate_notice_date
  - inmate_notice_time
  - hearing_after_time
  - status_141
  - stat_hvl_dsc_141
  - reason_802
  - rsn_hvl_desc_802
  - comment
  - drug_related
  - refer_formal_ind
unused_columns:
  - form_141
  - data_followup
  - sig_date
  - sig_time
  - user_id
  - inst_hvl_desc
  - place_hvl_desc
  - misconduct_time
  - others_involved
  - confinement_time
  - hearings_held
  - witnesses
  - inmate_version
  - recording_staff
  - rcrdng_staff_last
  - reviewing_staff
  - revwng_staff_last
  - date_reviewed
  - inmate_notice_date
  - inmate_notice_time
  - hearing_after_time
  - status_141
  - stat_hvl_dsc_141
  - reason_802
  - rsn_hvl_desc_802
  - comment
  - refer_formal_ind
output:
  StatePerson:
      external_ids:
        - StatePersonExternalId:
            external_id: control_number
            id_type: $literal("US_PA_CONT")
      incarceration_incidents:
        - StateIncarcerationIncident:
            external_id: misconduct_number
            incident_date: misconduct_date
            facility: institution
            location_within_facility:
              $concat:
                $values:
                  - place_hvl_code
                  - place_extended
                $include_nulls: False
            incident_type:
              # TODO(#9067): Add support for enum literals inside conditional
              $raw_text:
                $conditional:
                  $if:
                    $in:
                      $value: drug_related
                      $options:
                        - $literal("Y")
                  $then: $literal("CONTRABAND")
                  $else: $literal("REPORT")
              $mappings:
                StateIncarcerationIncidentType.CONTRABAND: CONTRABAND
                StateIncarcerationIncidentType.REPORT: REPORT
            incident_details:
              $json_dict:
                category_1: ctgory_of_chrgs_1
                category_2: ctgory_of_chrgs_2
                category_3: ctgory_of_chrgs_3
                category_4: ctgory_of_chrgs_4
                category_5: ctgory_of_chrgs_5
            incarceration_incident_outcomes:
              - StateIncarcerationIncidentOutcome:
                  external_id: misconduct_number
                  hearing_date: hearing_after_date
                  report_date: report_date
                  outcome_type:
                    $raw_text: confinement
                    $mappings:
                      StateIncarcerationIncidentOutcomeType.CELL_CONFINEMENT:
                        - C  # Cell Confinement
                      StateIncarcerationIncidentOutcomeType.RESTRICTED_CONFINEMENT:
                        - Y  # Restricted Confinement
                    $ignore:
                        - N  # No Confinement
                  date_effective:
                    $conditional:
                      $if:
                        $in:
                          $value: confinement
                          $options:
                            - $literal("Y")
                            - $literal("C")
                      $then: confinement_date
