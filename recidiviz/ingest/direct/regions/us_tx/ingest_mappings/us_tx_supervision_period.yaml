# yaml-language-server: $schema=./../../../ingest_mappings/yaml_schema/1.0.0/schema.json
# This file associates the columns outputted from the query in `view_supervision_period`
# to corresponding Ingest Object fields.
manifest_language: 1.0.0
input_columns:
  SID_Number: STRING
  Period_ID_Number: STRING
  supervision_officer: STRING
  status: STRING
  case_type: STRING
  start_date: DATETIME
  end_date: STRING
  assessment_level: STRING
  rn: STRING
  in_custody_flag: BOOLEAN
unused_columns: []
output:
  StatePerson:
    external_ids:
      - StatePersonExternalId:
          external_id: SID_Number
          id_type: $literal("US_TX_SID")
    supervision_periods:
      - StateSupervisionPeriod:
          external_id:
            $concat:
              $values:
                - Period_ID_Number
                - rn
          start_date: start_date
          #Todo(#35059 Consider early release when hydrating termination date)
          termination_date: end_date
          supervision_period_metadata:
            $normalized_values_json_dict:
              status: status
          supervising_officer_staff_external_id: supervision_officer
          supervising_officer_staff_external_id_type:
            $conditional:
              - $if:
                  $not_null: supervision_officer
                $then: $literal("US_TX_STAFF_ID")
          supervision_type: $literal_enum(StateSupervisionPeriodSupervisionType.PAROLE)
          supervision_level:
            $conditional:
              - $if:
                  $equal:
                    - case_type
                    - $literal("Annual")
                $then:
                  $enum_mapping:
                    $raw_text: case_type
                    $mappings:
                      StateSupervisionLevel.LIMITED:
                        - Annual
                      StateSupervisionLevel.UNSUPERVISED:
                        - Non-reporting
              - $else_if:
                  $and:
                    - $not_in:
                        $value: status
                        $options:
                          - $literal("Pre-Revocation - Not in Custody")
                    - $equal:
                        - in_custody_flag
                        - $literal("True")
                $then:
                  $enum_mapping:
                    $raw_text: status
                    $mappings:
                      StateSupervisionLevel.IN_CUSTODY:
                        - In custody - state jail
                        - In custody - county jail
                        - In Custody OOS - No PRW
                        - In Custody FCI - No PRW
                        - Pre-Revocation - In Custody
              - $else:
                  $enum_mapping:
                    $raw_text: assessment_level
                    $mappings:
                      StateSupervisionLevel.MINIMUM:
                        - L
                      StateSupervisionLevel.MEDIUM:
                        - LM
                      StateSupervisionLevel.HIGH:
                        - M
                      StateSupervisionLevel.MAXIMUM:
                        - MH
                        - H
          case_type_entries:
            - StateSupervisionCaseTypeEntry:
                case_type:
                  $enum_mapping:
                    $raw_text: case_type
                    $mappings:
                      StateSupervisionCaseType.GENERAL:
                        - Regular
                      StateSupervisionCaseType.SEX_OFFENSE:
                        - Sex offender
                      StateSupervisionCaseType.DRUG_COURT:
                        - Substance abuse
                      StateSupervisionCaseType.INTERNAL_UNKNOWN:
                        - Administrative
                        - Annual
                        - Non-reporting
                        - Other
                        - SRC (25 TO 1)
                      StateSupervisionCaseType.EXTERNAL_UNKNOWN:
                        - Unknown
                      StateSupervisionCaseType.SERIOUS_MENTAL_ILLNESS_OR_DISABILITY:
                        - Intellectually Disabled
                        - Mentally ill
                      StateSupervisionCaseType.ELECTRONIC_MONITORING:
                        - Electronic monitoring
                      StateSupervisionCaseType.INTENSE_SUPERVISION:
                        - Super-intensive supervision
                      StateSupervisionCaseType.DAY_REPORTING:
                        - Day/district resource center
                      StateSupervisionCaseType.PHYSICAL_ILLNESS_OR_DISABILITY:
                        - Terminally Ill / Physically Handicapped
                        - Medically recommended intensive supervision
